var targets = new WeakMap();

function getListeners(target) {
  var listeners = targets.get(target);

  if (!listeners) {
    listeners = new Set();
    targets.set(target, listeners);
  }

  return listeners;
}

var queue = new Set();

var run = function run(fn) {
  return fn();
};

function execute() {
  try {
    queue.forEach(function (target) {
      try {
        getListeners(target).forEach(run);
        queue.delete(target);
      } catch (e) {
        queue.delete(target);
        throw e;
      }
    });
  } catch (e) {
    if (queue.size) execute();
    throw e;
  }
}

export function dispatch(target) {
  if (!queue.size) {
    requestAnimationFrame(execute);
  }

  queue.add(target);
}
export function subscribe(target, cb) {
  var listeners = getListeners(target);
  listeners.add(cb);
  dispatch(target);
  return function () {
    return listeners.delete(cb);
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbWl0dGVyLmpzIl0sIm5hbWVzIjpbInRhcmdldHMiLCJXZWFrTWFwIiwiZ2V0TGlzdGVuZXJzIiwidGFyZ2V0IiwibGlzdGVuZXJzIiwiZ2V0IiwiU2V0Iiwic2V0IiwicXVldWUiLCJydW4iLCJmbiIsImV4ZWN1dGUiLCJmb3JFYWNoIiwiZGVsZXRlIiwiZSIsInNpemUiLCJkaXNwYXRjaCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImFkZCIsInN1YnNjcmliZSIsImNiIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFNQSxPQUFPLEdBQUcsSUFBSUMsT0FBSixFQUFoQjs7QUFFQSxTQUFTQyxZQUFULENBQXNCQyxNQUF0QixFQUE4QjtBQUM1QixNQUFJQyxTQUFTLEdBQUdKLE9BQU8sQ0FBQ0ssR0FBUixDQUFZRixNQUFaLENBQWhCOztBQUNBLE1BQUksQ0FBQ0MsU0FBTCxFQUFnQjtBQUNkQSxJQUFBQSxTQUFTLEdBQUcsSUFBSUUsR0FBSixFQUFaO0FBQ0FOLElBQUFBLE9BQU8sQ0FBQ08sR0FBUixDQUFZSixNQUFaLEVBQW9CQyxTQUFwQjtBQUNEOztBQUNELFNBQU9BLFNBQVA7QUFDRDs7QUFFRCxJQUFNSSxLQUFLLEdBQUcsSUFBSUYsR0FBSixFQUFkOztBQUNBLElBQU1HLEdBQUcsR0FBRyxTQUFOQSxHQUFNLENBQUFDLEVBQUU7QUFBQSxTQUFJQSxFQUFFLEVBQU47QUFBQSxDQUFkOztBQUVBLFNBQVNDLE9BQVQsR0FBbUI7QUFDakIsTUFBSTtBQUNGSCxJQUFBQSxLQUFLLENBQUNJLE9BQU4sQ0FBYyxVQUFDVCxNQUFELEVBQVk7QUFDeEIsVUFBSTtBQUNGRCxRQUFBQSxZQUFZLENBQUNDLE1BQUQsQ0FBWixDQUFxQlMsT0FBckIsQ0FBNkJILEdBQTdCO0FBQ0FELFFBQUFBLEtBQUssQ0FBQ0ssTUFBTixDQUFhVixNQUFiO0FBQ0QsT0FIRCxDQUdFLE9BQU9XLENBQVAsRUFBVTtBQUNWTixRQUFBQSxLQUFLLENBQUNLLE1BQU4sQ0FBYVYsTUFBYjtBQUNBLGNBQU1XLENBQU47QUFDRDtBQUNGLEtBUkQ7QUFTRCxHQVZELENBVUUsT0FBT0EsQ0FBUCxFQUFVO0FBQ1YsUUFBSU4sS0FBSyxDQUFDTyxJQUFWLEVBQWdCSixPQUFPO0FBQ3ZCLFVBQU1HLENBQU47QUFDRDtBQUNGOztBQUVELE9BQU8sU0FBU0UsUUFBVCxDQUFrQmIsTUFBbEIsRUFBMEI7QUFDL0IsTUFBSSxDQUFDSyxLQUFLLENBQUNPLElBQVgsRUFBaUI7QUFDZkUsSUFBQUEscUJBQXFCLENBQUNOLE9BQUQsQ0FBckI7QUFDRDs7QUFDREgsRUFBQUEsS0FBSyxDQUFDVSxHQUFOLENBQVVmLE1BQVY7QUFDRDtBQUVELE9BQU8sU0FBU2dCLFNBQVQsQ0FBbUJoQixNQUFuQixFQUEyQmlCLEVBQTNCLEVBQStCO0FBQ3BDLE1BQU1oQixTQUFTLEdBQUdGLFlBQVksQ0FBQ0MsTUFBRCxDQUE5QjtBQUNBQyxFQUFBQSxTQUFTLENBQUNjLEdBQVYsQ0FBY0UsRUFBZDtBQUNBSixFQUFBQSxRQUFRLENBQUNiLE1BQUQsQ0FBUjtBQUVBLFNBQU87QUFBQSxXQUFNQyxTQUFTLENBQUNTLE1BQVYsQ0FBaUJPLEVBQWpCLENBQU47QUFBQSxHQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB0YXJnZXRzID0gbmV3IFdlYWtNYXAoKTtcblxuZnVuY3Rpb24gZ2V0TGlzdGVuZXJzKHRhcmdldCkge1xuICBsZXQgbGlzdGVuZXJzID0gdGFyZ2V0cy5nZXQodGFyZ2V0KTtcbiAgaWYgKCFsaXN0ZW5lcnMpIHtcbiAgICBsaXN0ZW5lcnMgPSBuZXcgU2V0KCk7XG4gICAgdGFyZ2V0cy5zZXQodGFyZ2V0LCBsaXN0ZW5lcnMpO1xuICB9XG4gIHJldHVybiBsaXN0ZW5lcnM7XG59XG5cbmNvbnN0IHF1ZXVlID0gbmV3IFNldCgpO1xuY29uc3QgcnVuID0gZm4gPT4gZm4oKTtcblxuZnVuY3Rpb24gZXhlY3V0ZSgpIHtcbiAgdHJ5IHtcbiAgICBxdWV1ZS5mb3JFYWNoKCh0YXJnZXQpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGdldExpc3RlbmVycyh0YXJnZXQpLmZvckVhY2gocnVuKTtcbiAgICAgICAgcXVldWUuZGVsZXRlKHRhcmdldCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHF1ZXVlLmRlbGV0ZSh0YXJnZXQpO1xuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKHF1ZXVlLnNpemUpIGV4ZWN1dGUoKTtcbiAgICB0aHJvdyBlO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkaXNwYXRjaCh0YXJnZXQpIHtcbiAgaWYgKCFxdWV1ZS5zaXplKSB7XG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGV4ZWN1dGUpO1xuICB9XG4gIHF1ZXVlLmFkZCh0YXJnZXQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3Vic2NyaWJlKHRhcmdldCwgY2IpIHtcbiAgY29uc3QgbGlzdGVuZXJzID0gZ2V0TGlzdGVuZXJzKHRhcmdldCk7XG4gIGxpc3RlbmVycy5hZGQoY2IpO1xuICBkaXNwYXRjaCh0YXJnZXQpO1xuXG4gIHJldHVybiAoKSA9PiBsaXN0ZW5lcnMuZGVsZXRlKGNiKTtcbn1cbiJdfQ==